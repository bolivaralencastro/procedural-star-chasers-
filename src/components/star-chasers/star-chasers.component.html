<div class="relative w-full h-full" (contextmenu)="onContextMenu($event)">
    <canvas #gameCanvas
        class="w-full h-full block cursor-none"
        [class.pointer-events-none]="contextMenu.visible && !isMobile()">
    </canvas>

    @if (contextMenu.visible) {
        <div 
            #contextMenuEl
            class="absolute bg-gray-800/80 backdrop-blur-sm border border-gray-600 rounded-md shadow-xl text-white font-mono text-sm z-50 overflow-hidden w-52 context-menu pointer-events-auto"
            [style.left.px]="contextMenu.x"
            [style.top.px]="contextMenu.y">
            
            <div class="py-2 px-4 cursor-pointer hover:bg-gray-700/80 transition-colors"
                 (click)="toggleMouseInteraction($event)">
                {{ mouseInteractionEnabled() ? 'Disable Mouse' : 'Enable Mouse' }} (M)
            </div>

            <div class="py-2 px-4 cursor-pointer hover:bg-gray-700/80 transition-colors border-t border-gray-600"
                 (click)="onToggleAudio($event)">
                {{ audioService.isMuted() ? 'Unmute Audio' : 'Mute Audio' }} (S)
            </div>
            
            <div class="py-2 px-4 cursor-pointer hover:bg-gray-700/80 transition-colors border-t border-gray-600"
                 (click)="onToggleFullscreen($event)">
                {{ isFullscreen ? 'Exit Fullscreen' : 'Enter Fullscreen' }} (F)
            </div>
            
            @if (isMobile()) {
                <div class="py-2 px-4 cursor-pointer hover:bg-gray-700/80 transition-colors border-t border-gray-600"
                     (click)="onToggleWakeLock($event)">
                    {{ wakeLockService.getIsEnabled()() ? 'Disable Wake Lock' : 'Enable Wake Lock' }}
                </div>
            }

            <div class="px-4 py-3 border-t border-gray-600">
                <h4 class="text-xs text-gray-400 mb-2 uppercase tracking-wider">Ship Stats</h4>
                <div class="space-y-2">
                  @for(ship of ships; track ship.id) {
                    <div class="flex items-center justify-between text-xs">
                      <div class="flex items-center gap-2">
                        <span class="w-3 h-3 rounded-full" [style.background-color]="ship.hexColor"></span>
                        <span class="font-semibold">{{ ship.codename }}</span>
                      </div>
                      <div class="flex items-center gap-3 text-gray-300">
                        <span>★ {{ ship.score }}</span>
                        <span>☄ {{ ship.asteroidsDestroyed }}</span>
                      </div>
                    </div>
                  }
                </div>
            </div>
        </div>
    }
    
    <!-- Mobile Floating Menu -->
    @if (isMobile()) {
        <div class="absolute top-4 right-4 z-40 mobile-menu">
            <button 
                type="button"
                (click)="toggleMobileMenu()"
                class="flex items-center justify-center w-12 h-12 rounded-full bg-gray-800/80 backdrop-blur-sm border border-gray-600 text-white shadow-lg hover:bg-gray-700/90 transition-colors"
                title="Menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            
            @if (mobileMenuVisible()) {
                <div class="absolute top-14 right-0 bg-gray-800/90 backdrop-blur-sm border border-gray-600 rounded-md shadow-xl text-white font-mono text-sm z-50 overflow-hidden w-52 mobile-menu">
                    <div class="py-2 px-4 cursor-pointer hover:bg-gray-700/80 transition-colors"
                         (click)="toggleMouseInteraction($event)">
                        {{ mouseInteractionEnabled() ? 'Disable Touch' : 'Enable Touch' }}
                    </div>

                    <div class="py-2 px-4 cursor-pointer hover:bg-gray-700/80 transition-colors border-t border-gray-600"
                         (click)="onToggleAudio($event)">
                        {{ audioService.isMuted() ? 'Unmute Audio' : 'Mute Audio' }}
                    </div>
                    
                    <div class="py-2 px-4 cursor-pointer hover:bg-gray-700/80 transition-colors border-t border-gray-600"
                         (click)="onToggleFullscreen($event)">
                        {{ isFullscreen ? 'Exit Fullscreen' : 'Enter Fullscreen' }}
                    </div>
                    
                    <div class="py-2 px-4 cursor-pointer hover:bg-gray-700/80 transition-colors border-t border-gray-600"
                         (click)="onToggleWakeLock($event)">
                        {{ wakeLockService.getIsEnabled()() ? 'Disable Wake Lock' : 'Enable Wake Lock' }}
                    </div>

                    <div class="px-4 py-3 border-t border-gray-600">
                        <h4 class="text-xs text-gray-400 mb-2 uppercase tracking-wider">Ship Stats</h4>
                        <div class="space-y-2">
                          @for(ship of ships; track ship.id) {
                            <div class="flex items-center justify-between text-xs">
                              <div class="flex items-center gap-2">
                                <span class="w-3 h-3 rounded-full" [style.background-color]="ship.hexColor"></span>
                                <span class="font-semibold">{{ ship.codename }}</span>
                              </div>
                              <div class="flex items-center gap-3 text-gray-300">
                                <span>★ {{ ship.score }}</span>
                                <span>☄ {{ ship.asteroidsDestroyed }}</span>
                              </div>
                            </div>
                          }
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>
